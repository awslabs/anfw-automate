#!/usr/bin/env sh

echo "üîç Running pre-commit checks..."

# Validate branch name
yarn validate:branch

# Run lint-staged (formatting)
yarn exec lint-staged

# Security checks on full repository
echo "üîí Running security checks..."

# Scan for secrets with gitleaks
echo "  Scanning for secrets..."
if ! make security:secrets > /dev/null 2>&1; then
    echo "‚ùå ERROR: Secrets detected!"
    echo "   Run 'make security:secrets' for details"
    exit 1
fi
echo "  ‚úÖ No secrets detected"

# Run Python security scan with bandit
if command -v bandit >/dev/null 2>&1; then
    echo "  Running bandit on Python files..."
    if ! make security:python > /dev/null 2>&1; then
        echo "‚ö†Ô∏è  Bandit found security issues"
        echo "   Run 'make security:python' for details"
        exit 1
    fi
    echo "  ‚úÖ Python security checks passed"
else
    echo "  ‚ö†Ô∏è  Bandit not installed (pip install bandit)"
fi

echo "‚úÖ Pre-commit checks passed!"
