#!/usr/bin/env sh

echo "ğŸ” Running pre-commit checks..."

# Validate branch name
yarn validate:branch

# Run linting on all modules (same as CI)
echo "ğŸ” Running linting..."
if ! make lint; then
    echo "âŒ Linting failed. Fix issues before committing."
    exit 1
fi
echo "âœ… Linting passed"

# Check Prettier formatting on all files (same as CI)
echo "ğŸ¨ Checking code formatting..."
if ! yarn exec prettier --check "**/*.{ts,js,json,md,yml,yaml}" --ignore-path .prettierignore; then
    echo ""
    echo "âŒ Formatting issues detected!"
    echo "   Run 'make format' or 'yarn exec prettier --write \"**/*.{ts,js,json,md,yml,yaml}\"' to fix"
    exit 1
fi
echo "âœ… Formatting passed"

# Scan for secrets with gitleaks (critical - must catch before commit)
echo "ğŸ”’ Scanning for secrets..."
if ! make security:secrets > /dev/null 2>&1; then
    echo "âŒ ERROR: Secrets detected!"
    echo "   Run 'make security:secrets' for details"
    exit 1
fi
echo "âœ… No secrets detected"

echo "âœ… Pre-commit checks passed!"
