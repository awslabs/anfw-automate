echo "üîç Running pre-commit checks..."

# Validate branch name
npm run validate:branch

# Run lint-staged
npx lint-staged

# Run TypeScript compilation check
echo "üîß Checking TypeScript compilation..."
for module in app firewall vpc shared; do
    if [ -d "$module" ] && [ -f "$module/tsconfig.json" ]; then
        echo "  Checking $module..."
        cd "$module"
        npx tsc --noEmit || exit 1
        cd ..
    fi
done

# Run Python syntax check
echo "üêç Checking Python syntax..."
find . -name "*.py" -not -path "./node_modules/*" -not -path "./.venv/*" -not -path "./cdk.out/*" -not -path "./dist/*" | while read -r file; do
    python3 -m py_compile "$file" || exit 1
done

echo "‚úÖ Pre-commit checks passed!"